# Ansible Configuration Guide

This guide covers the Ansible configuration for installing and setting up Jenkins.

## Configuration Structure

```
ansible/
├── ansible.cfg          # Generated by Terraform
├── host_vars/          # Host-specific variables
├── inventory           # Generated by Terraform
├── playbook.yml        # Main playbook
└── roles/
    └── jenkins_plugins # Plugin installation role
```

## Playbook Components

### Pre-tasks
- System package update
- Git installation

### Main Tasks
1. Jenkins Repository Setup
   - GPG key download
   - Repository configuration

2. Dependencies Installation
   - OpenJDK 17
   - Required system packages

3. Jenkins Installation
   - Package installation
   - Service configuration
   - Initial setup validation

4. Plugin Installation
   - Custom role execution
   - Plugin configuration

## Usage

1. Verify Terraform-generated files:
   ```bash
   ls -la ansible.cfg inventory host_vars/
   ```

2. Run playbook:
   ```bash
   ansible-playbook playbook.yml
   ```

3. Verify installation:
   ```bash
   ansible jenkins -m ping
   ```

## Plugin Configuration

### Plugin Configuration

The plugins are configured in two files:

1. `roles/jenkins_plugins/vars/main.yml`:
```yaml
jenkins_plugins:
  - git
  - github
  - publish-over-ssh
```

2. `roles/jenkins_plugins/tasks/main.yml`:
```yaml
---
- name: read password
  command: cat /var/lib/jenkins/secrets/initialAdminPassword
  register: jenkins_password

- name: Install suggested plugins
  jenkins_plugin:
    name: "{{ item }}"
    url_username: admin
    url_password: "{{ jenkins_password.stdout }}"
    url: http://localhost:8080
  with_items: "{{ jenkins_plugins }}"

- name: Print Credential
  debug:
    msg: "Username: admin , Password: {{ jenkins_password.stdout }}"
```

The tasks will automatically:
- Retrieve the initial admin password
- Install specified plugins
- Display the credentials for initial login

## Troubleshooting

1. SSH Connection Issues:
   - Verify key permissions (should be 600)
   - Check security group rules
   - Validate inventory file

2. Jenkins Start Problems:
   - Check system logs: `sudo systemctl status jenkins`
   - Verify Java installation
   - Check port availability

3. Plugin Installation Failures:
   - Review Jenkins logs
   - Verify internet connectivity
   - Check plugin compatibility
